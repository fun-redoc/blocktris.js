{"filter":false,"title":"world.js","tooltip":"/world.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":2}},"text":"//"},{"action":"removeText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":17}},"text":"    })(cols,rows)"},{"action":"removeLines","range":{"start":{"row":1,"column":0},"end":{"row":18,"column":0}},"nl":"\n","lines":["","    var field = (function field(width, height) {","      var w = width","      var h = height","      var arr = [width*height]","      this.get = function(x,y) {","        return arr[y*w + x]","      }","      this.set = function(x,y,v) {","        if( x >= 0 && x < w && y >= 0 && y < h) {","          arr[y*w + x] = v","        }","        return this","      }","      this.width = w","      this.height = h","      return this"]},{"action":"removeText","range":{"start":{"row":0,"column":27},"end":{"row":0,"column":88}},"text":", enqueue, fallenShapeDelegate, moveSprite, removeFromView) {"},{"action":"removeText","range":{"start":{"row":0,"column":27},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":0,"column":27},"end":{"row":0,"column":30}},"text":") {"},{"action":"insertText","range":{"start":{"row":0,"column":30},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":1,"column":0},"end":{"row":1,"column":41}},"text":"function World(cols, rows, countPoints) {"},{"action":"removeLines","range":{"start":{"row":47,"column":0},"end":{"row":52,"column":0}},"nl":"\n","lines":["    var copyShapeToField = function(s) {","        fn.each(function(b) {","            field.set(b.x,b.y,b.color)","        }, s)","    }"]},{"action":"removeText","range":{"start":{"row":61,"column":5},"end":{"row":61,"column":19}},"text":"omeRowComplete"},{"action":"insertText","range":{"start":{"row":61,"column":5},"end":{"row":61,"column":15}},"text":"hrinkField"},{"action":"removeText","range":{"start":{"row":62,"column":12},"end":{"row":62,"column":55}},"text":"omeRowComplete(removeHandler, moveHandler, "},{"action":"insertText","range":{"start":{"row":62,"column":12},"end":{"row":62,"column":23}},"text":"hrinkField("},{"action":"insertText","range":{"start":{"row":64,"column":0},"end":{"row":64,"column":67}},"text":"    var result = {shrunkField:[], movedBlocks:[], rowsToRemove: []}"},{"action":"insertText","range":{"start":{"row":64,"column":67},"end":{"row":65,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":65,"column":0},"end":{"row":66,"column":0}},"lines":[""]},{"action":"insertText","range":{"start":{"row":69,"column":40},"end":{"row":69,"column":42}},"text":",i"},{"action":"insertText","range":{"start":{"row":71,"column":0},"end":{"row":71,"column":37}},"text":"          result.rowsToRemove.push(i)"},{"action":"insertText","range":{"start":{"row":71,"column":37},"end":{"row":72,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":78,"column":26},"end":{"row":78,"column":39}},"text":" return field"},{"action":"insertText","range":{"start":{"row":78,"column":26},"end":{"row":78,"column":27}},"text":"{"},{"action":"insertText","range":{"start":{"row":78,"column":27},"end":{"row":79,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":79,"column":0},"end":{"row":81,"column":0}},"lines":["        result.shrunkField = field","        return result"]},{"action":"insertText","range":{"start":{"row":81,"column":0},"end":{"row":81,"column":5}},"text":"    }"},{"action":"insertText","range":{"start":{"row":101,"column":0},"end":{"row":101,"column":2}},"text":"//"},{"action":"removeText","range":{"start":{"row":120,"column":12},"end":{"row":120,"column":37}},"text":"var $div = moveHandler(v,"},{"action":"insertText","range":{"start":{"row":120,"column":12},"end":{"row":120,"column":43}},"text":"a.movedBlocks.push({from:v, to:"},{"action":"insertText","range":{"start":{"row":120,"column":54},"end":{"row":120,"column":55}},"text":"}"},{"action":"removeText","range":{"start":{"row":121,"column":0},"end":{"row":121,"column":2}},"text":"//"},{"action":"removeText","range":{"start":{"row":123,"column":0},"end":{"row":123,"column":38}},"text":"          return a.concat(blockToMove)"},{"action":"removeLines","range":{"start":{"row":122,"column":0},"end":{"row":123,"column":0}},"nl":"\n","lines":["          }"]},{"action":"removeText","range":{"start":{"row":121,"column":10},"end":{"row":121,"column":57}},"text":"  debugWhenDivAndBlockDiffer($div, blockToMove)"},{"action":"removeText","range":{"start":{"row":121,"column":10},"end":{"row":122,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":121,"column":10},"end":{"row":121,"column":11}},"text":"}"},{"action":"insertText","range":{"start":{"row":121,"column":11},"end":{"row":122,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":122,"column":0},"end":{"row":123,"column":0}},"lines":["          a.shrunkField.push(blockToMove)"]},{"action":"insertText","range":{"start":{"row":123,"column":0},"end":{"row":123,"column":18}},"text":"          return a"},{"action":"removeText","range":{"start":{"row":124,"column":11},"end":{"row":124,"column":13}},"text":"[]"},{"action":"insertText","range":{"start":{"row":124,"column":11},"end":{"row":124,"column":17}},"text":"result"},{"action":"insertText","range":{"start":{"row":126,"column":0},"end":{"row":127,"column":0}},"text":"\n"},{"action":"removeText","range":{"start":{"row":139,"column":0},"end":{"row":139,"column":5}},"text":"    }"},{"action":"removeLines","range":{"start":{"row":128,"column":0},"end":{"row":139,"column":0}},"nl":"\n","lines":["})","    ","    ","    var shrinkField = function(world) {","        var lastRowComplete = someRowComplete(removeFromView,","                                            moveSprite,","                                            cols,","                                            fallenShapes)","        fallenShapes = lastRowComplete","        checkConsistency(world)","        return world"]},{"action":"removeText","range":{"start":{"row":127,"column":13},"end":{"row":127,"column":24}},"text":"shrunkField"},{"action":"removeText","range":{"start":{"row":127,"column":13},"end":{"row":128,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":127,"column":13},"end":{"row":127,"column":19}},"text":"result"},{"action":"insertText","range":{"start":{"row":127,"column":19},"end":{"row":128,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":128,"column":0},"end":{"row":128,"column":2}},"text":"})"},{"action":"removeText","range":{"start":{"row":143,"column":14},"end":{"row":143,"column":38}},"text":"copyShapeToField(dropped"},{"action":"insertText","range":{"start":{"row":143,"column":14},"end":{"row":143,"column":52}},"text":"shrunkField = shrinkField(cols, fallen"},{"action":"removeText","range":{"start":{"row":143,"column":57},"end":{"row":143,"column":58}},"text":")"},{"action":"insertText","range":{"start":{"row":143,"column":57},"end":{"row":143,"column":60}},"text":"s);"},{"action":"removeText","range":{"start":{"row":144,"column":25},"end":{"row":144,"column":55}},"text":"Delegate(shape, droppedShape);"},{"action":"insertText","range":{"start":{"row":144,"column":25},"end":{"row":144,"column":52}},"text":"s = shrunkField.shrunkField"},{"action":"removeText","range":{"start":{"row":145,"column":14},"end":{"row":145,"column":22}},"text":"world = "},{"action":"insertText","range":{"start":{"row":145,"column":14},"end":{"row":145,"column":26}},"text":"countPoints("},{"action":"removeText","range":{"start":{"row":145,"column":29},"end":{"row":145,"column":30}},"text":"i"},{"action":"insertText","range":{"start":{"row":145,"column":29},"end":{"row":145,"column":30}},"text":"u"},{"action":"removeText","range":{"start":{"row":145,"column":37},"end":{"row":145,"column":46}},"text":"(world); "},{"action":"insertText","range":{"start":{"row":145,"column":37},"end":{"row":145,"column":51}},"text":".rowsToRemove)"},{"action":"removeText","range":{"start":{"row":200,"column":0},"end":{"row":200,"column":53}},"text":"    World.prototype.field = function() { return field"},{"action":"removeText","range":{"start":{"row":199,"column":53},"end":{"row":199,"column":55}},"text":" }"},{"action":"removeText","range":{"start":{"row":199,"column":53},"end":{"row":200,"column":0}},"text":"\n"}]}]]},"ace":{"folds":[],"scrolltop":316,"scrollleft":18,"selection":{"start":{"row":0,"column":0},"end":{"row":0,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":18,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1416091983508,"hash":"07130aa76b4a3aee1ca7c626d1af282eef7bd5a1"}